<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RiverBot ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <h1>ğŸŒŠ RiverBot ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</h1>

  <div class="container">
    <!-- YOLO ì¸ì‹ë¥  -->
    <div class="card">
      <h2>YOLO ì¸ì‹ë¥ </h2>
      <div class="progress-bar">
        <div class="progress-fill" id="yolo-bar"></div>
      </div>
      <p id="yolo-value">0%</p>
    </div>

    <!-- í”Œë¼ìŠ¤í‹± -->
    <div class="card">
      <h2>í”Œë¼ìŠ¤í‹± ìˆ˜ê±°ë§</h2>
      <div class="gauge">
        <div class="gauge-inner">
          <div id="plastic">0%</div>
          <p>í˜„ì¬ ìˆ˜ê±°ìœ¨</p>
        </div>
      </div>
    </div>

    <!-- ì¼ë°˜ ì“°ë ˆê¸° -->
    <div class="card">
      <h2>ì¼ë°˜ ì“°ë ˆê¸° ìˆ˜ê±°ë§</h2>
      <div class="gauge">
        <div class="gauge-inner">
          <div id="general">0%</div>
          <p>í˜„ì¬ ìˆ˜ê±°ìœ¨</p>
        </div>
      </div>
    </div>

    <!-- ê¸ˆì† -->
    <div class="card">
      <h2>ê¸ˆì† ìˆ˜ê±°ë§</h2>
      <div class="gauge">
        <div class="gauge-inner">
          <div id="metal">0%</div>
          <p>í˜„ì¬ ìˆ˜ê±°ìœ¨</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const client = mqtt.connect("wss://broker.hivemq.com:8000/mqtt");
    client.on("connect", () => {
      console.log("âœ… MQTT Connected");
      client.subscribe("riverbot/bin");
    });

    client.on("message", (topic, message) => {
      try {
        const data = JSON.parse(message.toString());
        console.log("ğŸ“© ìˆ˜ì‹ :", data);

        // YOLO ì¸ì‹ë¥ 
        const yolo = parseFloat(data.yolo || 0).toFixed(1);
        document.getElementById("yolo-bar").style.width = `${yolo}%`;
        document.getElementById("yolo-value").innerText = `${yolo}%`;

        // í”Œë¼ìŠ¤í‹±
        const plastic = parseFloat(data.plastic || 0).toFixed(1);
        document.getElementById("plastic").innerText = `${plastic}%`;
        document.getElementById("plastic").parentElement.parentElement.style.background = `conic-gradient(#4CAF50 ${plastic}%, #ddd 0)`;

        // ì¼ë°˜
        const general = parseFloat(data.general || 0).toFixed(1);
        document.getElementById("general").innerText = `${general}%`;
        document.getElementById("general").parentElement.parentElement.style.background = `conic-gradient(#2196F3 ${general}%, #ddd 0)`;

        // ê¸ˆì†
        const metal = parseFloat(data.metal || 0).toFixed(1);
        document.getElementById("metal").innerText = `${metal}%`;
        document.getElementById("metal").parentElement.parentElement.style.background = `conic-gradient(#FF9800 ${metal}%, #ddd 0)`;

      } catch (e) {
        console.error(e);
      }
    });
  </script>
</body>
</html>
