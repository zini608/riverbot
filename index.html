<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RiverBot ìˆ˜ê±°ìœ¨ ëª¨ë‹ˆí„°</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/mqttws31.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸŒŠ RiverBot ì‹¤ì‹œê°„ ìˆ˜ê±°ìœ¨</h1>
    <p id="status">MQTT ì—°ê²° ì¤‘...</p>
    <div id="value">0%</div>
    <p id="alert"></p>
  </div>

  <script>
    // âœ… HiveMQ WebSocket ì„¤ì •
    const broker = "broker.hivemq.com";
    const port = 8000;
    const topic = "riverbot/#"; // ESP32ì—ì„œ ë³´ë‚¸ í† í”½
    const clientId = "webClient_" + Math.floor(Math.random() * 10000);

    const client = new Paho.MQTT.Client(broker, Number(port), clientId);

    client.onConnectionLost = (res) => {
      document.getElementById("status").innerText = "âŒ ì—°ê²° ëŠê¹€";
      console.log("ì—°ê²° ëŠê¹€:", res.errorMessage);
    };

    client.onMessageArrived = (msg) => {
      console.log("ğŸ“© ìˆ˜ì‹ :", msg.payloadString);
      try {
        const data = JSON.parse(msg.payloadString);
        if (data.collection !== undefined) {
          document.getElementById("value").innerText = data.collection.toFixed(1) + "%";
        }
        if (data.alert) {
          document.getElementById("alert").innerText = data.alert;
        } else {
          document.getElementById("alert").innerText = "";
        }
      } catch (e) {
        console.error("JSON íŒŒì‹± ì˜¤ë¥˜:", e);
      }
    };

    client.connect({
      useSSL: false,
      onSuccess: () => {
        document.getElementById("status").innerText = "âœ… ì—°ê²° ì„±ê³µ";
        console.log("âœ… HiveMQ ì—°ê²° ì„±ê³µ");
        client.subscribe(topic);
      },
      onFailure: (err) => {
        document.getElementById("status").innerText = "âŒ ì—°ê²° ì‹¤íŒ¨";
        console.error("âŒ ì—°ê²° ì‹¤íŒ¨:", err.errorMessage);
      }
    });
  </script>
</body>
</html>

